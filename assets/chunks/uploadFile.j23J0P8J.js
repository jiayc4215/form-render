import{_ as D}from"./index.6mVAzxpb.js";import{E as r,a as H}from"./theme.CSdZZP72.js";import{L as I,q,C as h,c as d,o as c,G as b,ap as P,w as y,h as z,a as p,e as B,F as S,j as O,t as C,k as g,p as V,a7 as T,P as G,aH as K,V as J}from"./framework.Ca1m3vMN.js";const Q={class:"component-upload-image"},W=["innerHTML"],X={key:1},Y={style:{color:"#f56c6c"}},Z={style:{color:"#f56c6c"}},ee={__name:"ManualUpload",props:{modelValue:[String,Object,Array],action:{type:String,default:"/sys/user/import"},limit:{type:Number,default:5},fileSize:{type:Number,default:5},fileType:{type:Array,default:()=>["xls","xlsx"]},isShowTip:{type:Boolean,default:!0},name:{type:String,default:"file"},parentTip:{type:String,default:""}},emits:["update:modelValue"],setup(l,{expose:i,emit:v}){let m=T([]),f=V(0),n=T({}),s=T({Authorization:"Bearer token"}),u=null;const x=V(""),_=v,o=l,w=I("uploaded"),E=z(()=>o.action),L=z(()=>o.isShowTip&&(o.fileType||o.fileSize));q(()=>o.modelValue,t=>{if(t){let e=1;m=(Array.isArray(t)?t:o.modelValue.split(",")).map(a=>(typeof a=="string"&&(a={name:a,url:a}),a.uid=a.uid||new Date().getTime()+e++,a))}else return m=[],[]},{deep:!0,immediate:!0});const U=t=>{if(o.fileType){let e="";if(t.name.lastIndexOf(".")>-1&&(e=t.name.slice(t.name.lastIndexOf(".")+1)),!o.fileType.some(a=>!!(t.type.indexOf(a)>-1||e&&e.indexOf(a)>-1)))return r({message:`文件格式不正确, 请上传${o.fileType.join(",")}格式文件!`,type:"error"}),!1}if(o.fileSize&&!(t.size/1024/1024<o.fileSize))return r({message:`上传文件大小不能超过 ${o.fileSize} MB!`,type:"error"}),!1;u=H.service({lock:!0,text:"正在上传文件，请稍候...",background:"rgba(0, 0, 0, 0.7)"}),f.value++},j=()=>{r({message:`上传文件数量不能超过 ${o.limit} 个!`,type:"error"})},F=t=>{w(t),r({message:"上传图片失败，请重试",type:"error"}),u.close()},M=async t=>{n={...t},await G(),x.value.submit()},N=(t,e)=>{_("update:modelValue",e)},A=(t,e)=>{_("update:modelValue",e)},R=(t,e)=>{console.log("上传成功的回调"),t.code===1e4?(u.close(),r({message:"上传成功",type:"success"})):t.code===401?r({message:"登录状态过期，请重新登录",type:"error"}):(f.value--,u.close(),r({message:"上传失败",type:"error"}),x.value.handleRemove(e)),w(t)},$=t=>{console.log(t)};return i({submitUpload:M}),(t,e)=>{const k=h("el-button"),a=h("el-upload");return c(),d("div",Q,[b(a,{class:"upload-demo",ref_key:"upload",ref:x,action:E.value,"on-preview":$,name:l.name,limit:l.limit,data:{...g(n)},accept:l.fileType.join(","),"on-error":F,"on-exceed":j,"on-success":R,"before-upload":U,"on-change":A,"on-remove":N,"file-list":g(m),headers:g(s),"auto-upload":!1},P({trigger:y(()=>[b(k,{size:"small",type:"primary"},{default:y(()=>[...e[0]||(e[0]=[p("选取文件",-1)])]),_:1})]),_:2},[L.value?{name:"tip",fn:y(()=>[l.parentTip?(c(),d("div",{key:0,innerHTML:l.parentTip},null,8,W)):(c(),d("div",X,[e[3]||(e[3]=p(" 请上传 ",-1)),l.fileSize?(c(),d(S,{key:0},[e[1]||(e[1]=p(" 大小不超过 ",-1)),O("b",Y,C(l.fileSize)+"MB",1)],64)):B("",!0),l.fileType?(c(),d(S,{key:1},[e[2]||(e[2]=p(" 格式为 ",-1)),O("b",Z,C(l.fileType.join(",")),1)],64)):B("",!0),e[4]||(e[4]=p(" 的文件 ",-1))]))]),key:"0"}:void 0]),1032,["action","name","limit","data","accept","file-list","headers"])])}}},le={__name:"uploadFile",setup(l){const i=V(""),v=T([{label:"上传文件",component:K(ee),el:{limit:1,action:"/api/sys/user/import"},id:"file",rules:[{required:!0,message:"请选上传文件",trigger:"blur",type:"array"}]}]),m=n=>{n.code!==500&&console.log(n,"上传结果")},f=()=>{try{i.value.validate(n=>{if(n){console.log("OK");let s=i.value.getFormValue();i.value.getComponentById("file").submitUpload(s),console.log(s)}else return console.log("error submit!!"),!1})}catch(n){console.log(n)}};return J("uploaded",m),(n,s)=>{const u=h("el-button");return c(),d(S,null,[b(g(D),{ref_key:"formRender",ref:i,content:v},null,8,["content"]),b(u,{size:"small",type:"primary",onClick:f},{default:y(()=>[...s[0]||(s[0]=[p("提交",-1)])]),_:1})],64)}}};export{le as _};
