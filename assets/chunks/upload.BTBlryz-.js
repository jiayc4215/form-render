import{_ as $}from"./index.BkLuhzM2.js";import{p as P,E as r,a as G}from"./theme.QxNqPTeT.js";import{_ as H,q as J,C as V,c as k,o as w,G as u,ap as K,w as p,h as U,j as _,a as g,e as A,F as S,t as C,k as d,n as Q,a7 as h,p as v,a6 as W,aH as X}from"./framework.Ca1m3vMN.js";const Y={class:"component-upload-image"},Z={style:{color:"#f56c6c"}},ee={style:{color:"#f56c6c"}},te=["src"],le={__name:"ImageUpload",props:{modelValue:[String,Object,Array],action:{type:String,default:"/dev-api/admin/product/fileUpload"},extralData:{type:Object,default:()=>({})},limit:{type:Number,default:5},fileSize:{type:Number,default:5},fileType:{type:Array,default:()=>["png","jpg","jpeg"]},isShowTip:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(s,{emit:y}){let c=h([]),m=v(0),o=h([]),x=h({Authorization:"Bearer 1111"}),n=v(""),i=v(!1),b=null;const a=s,E=h({a:1}),T=y,B=v(""),I=U(()=>a.isShowTip&&(a.fileType||a.fileSize));J(()=>a.modelValue,e=>{if(console.log("watch触发",e),e)o=(Array.isArray(e)?e:Array.isArray(a.modelValue.split(","))?a.modelValue.split(","):Array.of(a.modelValue)).map(l=>(typeof l=="string"&&(l={name:l,url:l}),l)),console.log(o,"数据回显fileList");else return o=[],[]});const O=()=>{T("update:modelValue",j(o))},L=U(()=>a.action),N=(e,t)=>{e.code===200?(c.push({name:e.data,url:e.data}),c.length===m.value&&(o=o.concat(c),c=[],m.value=0,T("update:modelValue",j(o)),b.close()),b.close(),r({message:"上传成功",type:"success"})):e.code===401?r({message:"登录状态过期，请重新登录",type:"error"}):(m.value--,b.close(),r({message:"上传失败",type:"error"}),B.value.handleRemove(t))},R=e=>{let t=!1;if(a.fileType.length){let l="";e.name.lastIndexOf(".")>-1&&(l=e.name.slice(e.name.lastIndexOf(".")+1)),t=a.fileType.some(f=>e.type.indexOf(f)>-1?!0:!!(l&&l.indexOf(f)>-1))}else t=e.type.indexOf("image")>-1;if(!t)return r({message:`文件格式不正确, 请上传${a.fileType.join("/")}图片格式文件!`,type:"error"}),!1;if(a.fileSize&&!(e.size/1024/1024<a.fileSize))return r({message:`上传图片大小不能超过 ${a.fileSize} MB!`,type:"error"}),!1;b=G.service({lock:!0,text:"正在上传图片，请稍候...",background:"rgba(0, 0, 0, 0.7)"}),m.value++},j=(e,t)=>{let l="";t=t||",";for(let f in e)l+=e[f].url+t;return l!==""?l.substr(0,l.length-1):""},D=e=>{console.log(e),r({message:"上传图片失败，请重试",type:"error"}),b.close()},F=()=>{r({message:`上传文件数量不能超过 ${a.limit} 个!`,type:"error"})},M=e=>{n.value=e.url,i.value=!0};return(e,t)=>{const l=V("el-icon"),f=V("el-upload"),q=V("el-dialog");return w(),k("div",Y,[u(f,{ref_key:"upload",ref:B,disabled:s.disabled,multiple:"",action:L.value,"list-type":"picture-card","on-success":N,"before-upload":R,limit:s.limit,"on-error":D,"on-exceed":F,data:{...E,...s.extralData},name:"file","on-remove":O,"show-file-list":!0,headers:d(x),"file-list":d(o),"on-preview":M,class:Q({hide:d(o).length>=s.limit})},K({default:p(()=>[u(l,{class:"avatar-uploader-icon"},{default:p(()=>[u(d(P))]),_:1})]),_:2},[I.value?{name:"tip",fn:p(()=>[_("div",null,[t[3]||(t[3]=g(" 请上传 ",-1)),s.fileSize?(w(),k(S,{key:0},[t[1]||(t[1]=g(" 大小不超过 ",-1)),_("b",Z,C(s.fileSize)+"MB",1)],64)):A("",!0),s.fileType?(w(),k(S,{key:1},[t[2]||(t[2]=g(" 格式为 ",-1)),_("b",ee,C(s.fileType.join("/")),1)],64)):A("",!0),t[4]||(t[4]=g(" 的文件 ",-1))])]),key:"0"}:void 0]),1032,["disabled","action","limit","data","headers","file-list","class"]),u(q,{modelValue:d(i),"onUpdate:modelValue":t[0]||(t[0]=z=>W(i)?i.value=z:i=z),title:"预览",width:"800","append-to-body":""},{default:p(()=>[_("img",{src:d(n),style:{display:"block","max-width":"100%",margin:"0 auto"}},null,8,te)]),_:1},8,["modelValue"])])}}},ae=H(le,[["__scopeId","data-v-3b23cc7d"]]),ne={__name:"upload",setup(s){const y=v(""),c=h([{label:"图片上传",component:X(ae),el:{isShowTip:!1,limit:2,extralData:{type:"identityBack"}},id:"identityBack",rules:[{required:!0,message:"请选择门头照",trigger:"blur"}]}]),m=()=>{const x=y.value.getFormValue();console.log(x)},o=()=>{y.value.updateForm({identityBack:"https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100,https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100"})};return(x,n)=>{const i=V("el-button");return w(),k(S,null,[u(d($),{ref_key:"formRender",ref:y,content:c},null,8,["content"]),u(i,{onClick:m},{default:p(()=>[...n[0]||(n[0]=[g("获取图片地址",-1)])]),_:1}),u(i,{onClick:o},{default:p(()=>[...n[1]||(n[1]=[g("设置图片地址",-1)])]),_:1})],64)}}};export{ne as _};
